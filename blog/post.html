<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post | Bitroot Newslogger</title>
    <meta name="description" content="Read this article on the Bitroot newslogger.">

    <!-- Open Graph (defaults, updated dynamically per post) -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="Newslogger | Bitroot">
    <meta property="og:description" content="Read this article on the Bitroot newslogger.">
    <meta property="og:url" content="https://bitroot.org/blog">
    <meta property="og:image" content="https://bitroot.org/images/newslogger-og.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="Bitroot Newslogger">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Newslogger | Bitroot">
    <meta name="twitter:description" content="Read this article on the Bitroot newslogger.">
    <meta name="twitter:image" content="https://bitroot.org/images/newslogger-og.jpg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Geist+Mono:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" type="application/rss+xml" title="Newslogger | Bitroot" href="/rss.xml">
    <link rel="stylesheet" href="css/blog.css">
    <link rel="stylesheet" href="css/post.css">

    <!-- Markdown parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Theme: set before first paint -->
    <script>
        (function() {
            var saved = localStorage.getItem('nl-theme');
            var theme = saved || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
</head>
<body>
    <!-- Pixelated floating clouds -->
    <div class="cloud-ticker" aria-hidden="true">
        <div class="cloud-ticker-track">
            <svg width="2400" height="320" viewBox="0 0 2400 320" fill="#1f76f9" shape-rendering="crispEdges">
                <rect x="80" y="60" width="16" height="16"/><rect x="96" y="60" width="16" height="16"/><rect x="112" y="60" width="16" height="16"/>
                <rect x="64" y="76" width="16" height="16"/><rect x="80" y="76" width="16" height="16"/><rect x="96" y="76" width="16" height="16"/><rect x="112" y="76" width="16" height="16"/><rect x="128" y="76" width="16" height="16"/>
                <rect x="48" y="92" width="16" height="16"/><rect x="64" y="92" width="16" height="16"/><rect x="80" y="92" width="16" height="16"/><rect x="96" y="92" width="16" height="16"/><rect x="112" y="92" width="16" height="16"/><rect x="128" y="92" width="16" height="16"/><rect x="144" y="92" width="16" height="16"/>
                <rect x="320" y="160" width="12" height="12"/><rect x="332" y="160" width="12" height="12"/>
                <rect x="308" y="172" width="12" height="12"/><rect x="320" y="172" width="12" height="12"/><rect x="332" y="172" width="12" height="12"/><rect x="344" y="172" width="12" height="12"/>
                <rect x="308" y="184" width="12" height="12"/><rect x="320" y="184" width="12" height="12"/><rect x="332" y="184" width="12" height="12"/><rect x="344" y="184" width="12" height="12"/>
                <rect x="560" y="40" width="14" height="14"/><rect x="574" y="40" width="14" height="14"/><rect x="588" y="40" width="14" height="14"/>
                <rect x="546" y="54" width="14" height="14"/><rect x="560" y="54" width="14" height="14"/><rect x="574" y="54" width="14" height="14"/><rect x="588" y="54" width="14" height="14"/><rect x="602" y="54" width="14" height="14"/>
                <rect x="532" y="68" width="14" height="14"/><rect x="546" y="68" width="14" height="14"/><rect x="560" y="68" width="14" height="14"/><rect x="574" y="68" width="14" height="14"/><rect x="588" y="68" width="14" height="14"/><rect x="602" y="68" width="14" height="14"/><rect x="616" y="68" width="14" height="14"/>
                <rect x="780" y="200" width="10" height="10"/><rect x="790" y="200" width="10" height="10"/>
                <rect x="770" y="210" width="10" height="10"/><rect x="780" y="210" width="10" height="10"/><rect x="790" y="210" width="10" height="10"/><rect x="800" y="210" width="10" height="10"/>
                <rect x="980" y="120" width="16" height="16"/><rect x="996" y="120" width="16" height="16"/><rect x="1012" y="120" width="16" height="16"/>
                <rect x="964" y="136" width="16" height="16"/><rect x="980" y="136" width="16" height="16"/><rect x="996" y="136" width="16" height="16"/><rect x="1012" y="136" width="16" height="16"/><rect x="1028" y="136" width="16" height="16"/><rect x="1044" y="136" width="16" height="16"/>
                <rect x="948" y="152" width="16" height="16"/><rect x="964" y="152" width="16" height="16"/><rect x="980" y="152" width="16" height="16"/><rect x="996" y="152" width="16" height="16"/><rect x="1012" y="152" width="16" height="16"/><rect x="1028" y="152" width="16" height="16"/><rect x="1044" y="152" width="16" height="16"/><rect x="1060" y="152" width="16" height="16"/>
                <rect x="1250" y="30" width="12" height="12"/><rect x="1262" y="30" width="12" height="12"/>
                <rect x="1238" y="42" width="12" height="12"/><rect x="1250" y="42" width="12" height="12"/><rect x="1262" y="42" width="12" height="12"/><rect x="1274" y="42" width="12" height="12"/>
                <rect x="1238" y="54" width="12" height="12"/><rect x="1250" y="54" width="12" height="12"/><rect x="1262" y="54" width="12" height="12"/><rect x="1274" y="54" width="12" height="12"/>
                <rect x="1500" y="170" width="14" height="14"/><rect x="1514" y="170" width="14" height="14"/><rect x="1528" y="170" width="14" height="14"/>
                <rect x="1486" y="184" width="14" height="14"/><rect x="1500" y="184" width="14" height="14"/><rect x="1514" y="184" width="14" height="14"/><rect x="1528" y="184" width="14" height="14"/><rect x="1542" y="184" width="14" height="14"/>
                <rect x="1486" y="198" width="14" height="14"/><rect x="1500" y="198" width="14" height="14"/><rect x="1514" y="198" width="14" height="14"/><rect x="1528" y="198" width="14" height="14"/><rect x="1542" y="198" width="14" height="14"/>
                <rect x="1780" y="80" width="10" height="10"/><rect x="1790" y="80" width="10" height="10"/>
                <rect x="1770" y="90" width="10" height="10"/><rect x="1780" y="90" width="10" height="10"/><rect x="1790" y="90" width="10" height="10"/><rect x="1800" y="90" width="10" height="10"/>
                <rect x="2000" y="100" width="16" height="16"/><rect x="2016" y="100" width="16" height="16"/><rect x="2032" y="100" width="16" height="16"/>
                <rect x="1984" y="116" width="16" height="16"/><rect x="2000" y="116" width="16" height="16"/><rect x="2016" y="116" width="16" height="16"/><rect x="2032" y="116" width="16" height="16"/><rect x="2048" y="116" width="16" height="16"/>
                <rect x="1968" y="132" width="16" height="16"/><rect x="1984" y="132" width="16" height="16"/><rect x="2000" y="132" width="16" height="16"/><rect x="2016" y="132" width="16" height="16"/><rect x="2032" y="132" width="16" height="16"/><rect x="2048" y="132" width="16" height="16"/><rect x="2064" y="132" width="16" height="16"/>
                <rect x="2250" y="240" width="12" height="12"/><rect x="2262" y="240" width="12" height="12"/>
                <rect x="2238" y="252" width="12" height="12"/><rect x="2250" y="252" width="12" height="12"/><rect x="2262" y="252" width="12" height="12"/><rect x="2274" y="252" width="12" height="12"/>
            </svg>
            <svg width="2400" height="320" viewBox="0 0 2400 320" fill="#1f76f9" shape-rendering="crispEdges">
                <rect x="80" y="60" width="16" height="16"/><rect x="96" y="60" width="16" height="16"/><rect x="112" y="60" width="16" height="16"/>
                <rect x="64" y="76" width="16" height="16"/><rect x="80" y="76" width="16" height="16"/><rect x="96" y="76" width="16" height="16"/><rect x="112" y="76" width="16" height="16"/><rect x="128" y="76" width="16" height="16"/>
                <rect x="48" y="92" width="16" height="16"/><rect x="64" y="92" width="16" height="16"/><rect x="80" y="92" width="16" height="16"/><rect x="96" y="92" width="16" height="16"/><rect x="112" y="92" width="16" height="16"/><rect x="128" y="92" width="16" height="16"/><rect x="144" y="92" width="16" height="16"/>
                <rect x="320" y="160" width="12" height="12"/><rect x="332" y="160" width="12" height="12"/>
                <rect x="308" y="172" width="12" height="12"/><rect x="320" y="172" width="12" height="12"/><rect x="332" y="172" width="12" height="12"/><rect x="344" y="172" width="12" height="12"/>
                <rect x="308" y="184" width="12" height="12"/><rect x="320" y="184" width="12" height="12"/><rect x="332" y="184" width="12" height="12"/><rect x="344" y="184" width="12" height="12"/>
                <rect x="560" y="40" width="14" height="14"/><rect x="574" y="40" width="14" height="14"/><rect x="588" y="40" width="14" height="14"/>
                <rect x="546" y="54" width="14" height="14"/><rect x="560" y="54" width="14" height="14"/><rect x="574" y="54" width="14" height="14"/><rect x="588" y="54" width="14" height="14"/><rect x="602" y="54" width="14" height="14"/>
                <rect x="532" y="68" width="14" height="14"/><rect x="546" y="68" width="14" height="14"/><rect x="560" y="68" width="14" height="14"/><rect x="574" y="68" width="14" height="14"/><rect x="588" y="68" width="14" height="14"/><rect x="602" y="68" width="14" height="14"/><rect x="616" y="68" width="14" height="14"/>
                <rect x="780" y="200" width="10" height="10"/><rect x="790" y="200" width="10" height="10"/>
                <rect x="770" y="210" width="10" height="10"/><rect x="780" y="210" width="10" height="10"/><rect x="790" y="210" width="10" height="10"/><rect x="800" y="210" width="10" height="10"/>
                <rect x="980" y="120" width="16" height="16"/><rect x="996" y="120" width="16" height="16"/><rect x="1012" y="120" width="16" height="16"/>
                <rect x="964" y="136" width="16" height="16"/><rect x="980" y="136" width="16" height="16"/><rect x="996" y="136" width="16" height="16"/><rect x="1012" y="136" width="16" height="16"/><rect x="1028" y="136" width="16" height="16"/><rect x="1044" y="136" width="16" height="16"/>
                <rect x="948" y="152" width="16" height="16"/><rect x="964" y="152" width="16" height="16"/><rect x="980" y="152" width="16" height="16"/><rect x="996" y="152" width="16" height="16"/><rect x="1012" y="152" width="16" height="16"/><rect x="1028" y="152" width="16" height="16"/><rect x="1044" y="152" width="16" height="16"/><rect x="1060" y="152" width="16" height="16"/>
                <rect x="1250" y="30" width="12" height="12"/><rect x="1262" y="30" width="12" height="12"/>
                <rect x="1238" y="42" width="12" height="12"/><rect x="1250" y="42" width="12" height="12"/><rect x="1262" y="42" width="12" height="12"/><rect x="1274" y="42" width="12" height="12"/>
                <rect x="1238" y="54" width="12" height="12"/><rect x="1250" y="54" width="12" height="12"/><rect x="1262" y="54" width="12" height="12"/><rect x="1274" y="54" width="12" height="12"/>
                <rect x="1500" y="170" width="14" height="14"/><rect x="1514" y="170" width="14" height="14"/><rect x="1528" y="170" width="14" height="14"/>
                <rect x="1486" y="184" width="14" height="14"/><rect x="1500" y="184" width="14" height="14"/><rect x="1514" y="184" width="14" height="14"/><rect x="1528" y="184" width="14" height="14"/><rect x="1542" y="184" width="14" height="14"/>
                <rect x="1486" y="198" width="14" height="14"/><rect x="1500" y="198" width="14" height="14"/><rect x="1514" y="198" width="14" height="14"/><rect x="1528" y="198" width="14" height="14"/><rect x="1542" y="198" width="14" height="14"/>
                <rect x="1780" y="80" width="10" height="10"/><rect x="1790" y="80" width="10" height="10"/>
                <rect x="1770" y="90" width="10" height="10"/><rect x="1780" y="90" width="10" height="10"/><rect x="1790" y="90" width="10" height="10"/><rect x="1800" y="90" width="10" height="10"/>
                <rect x="2000" y="100" width="16" height="16"/><rect x="2016" y="100" width="16" height="16"/><rect x="2032" y="100" width="16" height="16"/>
                <rect x="1984" y="116" width="16" height="16"/><rect x="2000" y="116" width="16" height="16"/><rect x="2016" y="116" width="16" height="16"/><rect x="2032" y="116" width="16" height="16"/><rect x="2048" y="116" width="16" height="16"/>
                <rect x="1968" y="132" width="16" height="16"/><rect x="1984" y="132" width="16" height="16"/><rect x="2000" y="132" width="16" height="16"/><rect x="2016" y="132" width="16" height="16"/><rect x="2032" y="132" width="16" height="16"/><rect x="2048" y="132" width="16" height="16"/><rect x="2064" y="132" width="16" height="16"/>
                <rect x="2250" y="240" width="12" height="12"/><rect x="2262" y="240" width="12" height="12"/>
                <rect x="2238" y="252" width="12" height="12"/><rect x="2250" y="252" width="12" height="12"/><rect x="2262" y="252" width="12" height="12"/><rect x="2274" y="252" width="12" height="12"/>
            </svg>
        </div>
    </div>

    <!-- Minimal Header -->
    <header class="header">
        <nav class="nav">
            <a href="/" class="logo"><img src="/images/bitroot-dark-text-border.png" alt="Bitroot" class="logo-img"></a>
            <div class="nav-links">
                <a href="/blog" class="nav-link">newslogger</a>
                <a href="/" class="nav-link">home</a>
                <button class="theme-toggle" aria-label="Toggle theme">
                    <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                    <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                </button>
            </div>
        </nav>
    </header>

    <!-- Post Content -->
    <main class="post-page">
        <article class="post-article" id="post-content">
            <div class="post-loading">Loading...</div>
        </article>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <span class="footer-text">&copy; 2026 Bitroot</span>
            <div class="footer-links">
                <a href="https://github.com/bitroot-org" class="footer-link">GitHub</a>
                <a href="https://x.com/BitrootIndia" class="footer-link">X</a>
                <a href="/rss.xml" class="footer-link">RSS</a>
            </div>
        </div>
    </footer>

    <!-- Theme toggle -->
    <script>
    (function() {
        var btn = document.querySelector('.theme-toggle');
        if (!btn) return;
        btn.addEventListener('click', function() {
            var current = document.documentElement.getAttribute('data-theme');
            var next = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('nl-theme', next);
        });
    })();
    </script>

    <script>
        /**
         * Parse YAML frontmatter from markdown content
         */
        function parseFrontmatter(content) {
            const match = content.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)$/);
            if (!match) {
                return { metadata: {}, content };
            }

            const yamlStr = match[1];
            const markdownContent = match[2];

            const metadata = {};
            const lines = yamlStr.split('\n');
            let currentKey = null;
            let currentArray = null;

            for (const line of lines) {
                if (line.match(/^\s+-\s+/)) {
                    const value = line.replace(/^\s+-\s+/, '').trim();
                    if (currentArray && currentKey) {
                        metadata[currentKey].push(value.replace(/^["']|["']$/g, ''));
                    }
                    continue;
                }

                const kvMatch = line.match(/^(\w+):\s*(.*)$/);
                if (kvMatch) {
                    const [, key, value] = kvMatch;
                    currentKey = key;

                    if (value === '' || value === '[]') {
                        metadata[key] = [];
                        currentArray = true;
                    } else if (value.startsWith('[') && value.endsWith(']')) {
                        metadata[key] = value
                            .slice(1, -1)
                            .split(',')
                            .map(s => s.trim().replace(/^["']|["']$/g, ''));
                        currentArray = false;
                    } else {
                        metadata[key] = value.replace(/^["']|["']$/g, '');
                        currentArray = false;
                    }
                }
            }

            return { metadata, content: markdownContent };
        }

        /**
         * Format date for display (uses browser locale)
         */
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const locale = navigator.language || 'en-US';
            return date.toLocaleDateString(locale, {
                month: 'long',
                day: 'numeric',
                year: 'numeric'
            });
        }

        /**
         * Format date with time for display (uses browser locale)
         */
        function formatDateTime(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            const locale = navigator.language || 'en-US';
            return date.toLocaleString(locale, {
                month: 'long',
                day: 'numeric',
                year: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        }

        const PLACEHOLDER_IMAGE = 'https://placehold.net/4-800x600.png';

        function getPlaceholder() {
            return PLACEHOLDER_IMAGE;
        }

        /**
         * Load and render the post
         */
        async function loadPost() {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');

            if (!slug) {
                document.getElementById('post-content').innerHTML = `
                    <div class="post-error">
                        <h1>Post Not Found</h1>
                        <p>No post specified. <a href="/blog">Return to newslogger</a></p>
                    </div>
                `;
                return;
            }

            try {
                const response = await fetch(`posts/${slug}.md`);
                if (!response.ok) throw new Error('Post not found');

                const text = await response.text();
                const { metadata, content } = parseFrontmatter(text);

                // Update page title and OG meta tags
                document.title = `${metadata.title || 'Post'} | Bitroot Newslogger`;

                const postUrl = window.location.href;
                const postImage = metadata.image || 'https://bitroot.org/images/newslogger-og.jpg';
                const postExcerpt = metadata.excerpt || 'Read this article on the Bitroot newslogger.';

                document.querySelector('meta[property="og:title"]').setAttribute('content', metadata.title || 'Post');
                document.querySelector('meta[property="og:description"]').setAttribute('content', postExcerpt);
                document.querySelector('meta[property="og:url"]').setAttribute('content', postUrl);
                document.querySelector('meta[property="og:image"]').setAttribute('content', postImage);
                document.querySelector('meta[name="twitter:title"]').setAttribute('content', metadata.title || 'Post');
                document.querySelector('meta[name="twitter:description"]').setAttribute('content', postExcerpt);
                document.querySelector('meta[name="twitter:image"]').setAttribute('content', postImage);
                document.querySelector('meta[name="description"]').setAttribute('content', postExcerpt);

                // Calculate read time
                const readTime = Math.ceil(content.split(/\s+/).length / 200);

                // Render post
                const tag = (metadata.tags && metadata.tags[0]) || 'General';
                const html = marked.parse(content);

                // Get image - use metadata image, or fallback to placeholder
                let heroImage = metadata.image;
                if (!heroImage) {
                    heroImage = getPlaceholder();
                }

                // Check if we have a video (local or remote)
                const hasVideo = metadata.video && !metadata.video.includes('twimg.com');
                const isGif = metadata.video && (metadata.video.includes('.gif') || metadata.video.includes('gif'));

                // Format date - use published_at if available, otherwise fallback to date
                const displayDate = metadata.published_at ? formatDateTime(metadata.published_at) : formatDate(metadata.date);

                document.getElementById('post-content').innerHTML = `
                    ${hasVideo ? `
                        <div class="post-hero-video">
                            <video
                                id="hero-video"
                                src="${metadata.video}"
                                playsinline
                                loop
                                muted
                                autoplay
                                poster="${heroImage}"
                                onerror="this.parentElement.innerHTML='<div class=\\'post-hero-image\\'><img src=\\'${heroImage}\\' alt=\\'${metadata.title || 'Post image'}\\'></div>'"
                            >
                                Your browser does not support the video tag.
                            </video>
                            <button class="video-mute-btn" id="mute-btn" aria-label="Toggle sound">
                                <svg class="muted-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                    <line x1="23" y1="9" x2="17" y2="15"></line>
                                    <line x1="17" y1="9" x2="23" y2="15"></line>
                                </svg>
                                <svg class="unmuted-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
                                    <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
                                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                </svg>
                            </button>
                        </div>
                    ` : `
                        <div class="post-hero-image">
                            <img src="${heroImage}" alt="${metadata.title || 'Post image'}" onerror="this.src='${getPlaceholder()}'">
                        </div>
                    `}
                    <header class="post-header">
                        <div class="post-meta">
                            <span class="post-tag">${tag}</span>
                            <span class="post-date">${displayDate}</span>
                            <span class="post-read-time">${readTime} min read</span>
                        </div>
                        <h1 class="post-title">${metadata.title || 'Untitled'}</h1>
                    </header>
                    <div class="post-body">
                        ${html}
                    </div>
                    <nav class="post-nav">
                        <a href="/blog" class="back-link">&larr; Back to newslogger</a>
                        <div class="post-nav-actions">
                            <button class="share-btn" id="share-btn" aria-label="Share this post" title="Share">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="18" cy="5" r="3"></circle>
                                    <circle cx="6" cy="12" r="3"></circle>
                                    <circle cx="18" cy="19" r="3"></circle>
                                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                                </svg>
                            </button>
                            ${metadata.sources && metadata.sources.length > 0 ? `
                                <a href="${metadata.sources[0]}" target="_blank" rel="noopener" class="source-link" title="View original source">
                                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                                        <polyline points="15 3 21 3 21 9"></polyline>
                                        <line x1="10" y1="14" x2="21" y2="3"></line>
                                    </svg>
                                </a>
                            ` : ''}
                        </div>
                    </nav>
                `;

                // Setup video mute toggle if video exists
                const video = document.getElementById('hero-video');
                const muteBtn = document.getElementById('mute-btn');
                if (video && muteBtn) {
                    muteBtn.addEventListener('click', () => {
                        video.muted = !video.muted;
                        const mutedIcon = muteBtn.querySelector('.muted-icon');
                        const unmutedIcon = muteBtn.querySelector('.unmuted-icon');
                        if (video.muted) {
                            mutedIcon.style.display = 'block';
                            unmutedIcon.style.display = 'none';
                        } else {
                            mutedIcon.style.display = 'none';
                            unmutedIcon.style.display = 'block';
                        }
                    });
                }

                // Build short share URL from index.json
                let shareUrl = postUrl;
                try {
                    const idxRes = await fetch('posts/index.json');
                    if (idxRes.ok) {
                        const idx = await idxRes.json();
                        const entry = (idx.metadata || []).find(m => m.slug === slug);
                        if (entry && entry.shortId) {
                            shareUrl = `https://bitroot.org/blog/p/${entry.shortId}`;
                        }
                    }
                } catch (_) { /* use full URL as fallback */ }

                // Share button
                const shareBtn = document.getElementById('share-btn');
                if (shareBtn) {
                    shareBtn.addEventListener('click', async () => {
                        const shareData = {
                            title: metadata.title || 'Newslogger | Bitroot',
                            text: postExcerpt,
                            url: shareUrl
                        };

                        if (navigator.share) {
                            try {
                                await navigator.share(shareData);
                            } catch (err) {
                                // User cancelled or share failed â€” ignore
                            }
                        } else {
                            // Fallback: copy link to clipboard
                            try {
                                await navigator.clipboard.writeText(shareUrl);
                                shareBtn.classList.add('copied');
                                shareBtn.title = 'Link copied!';
                                setTimeout(() => {
                                    shareBtn.classList.remove('copied');
                                    shareBtn.title = 'Share';
                                }, 2000);
                            } catch (err) {
                                // Last resort: open Twitter share
                                window.open(`https://x.com/intent/tweet?text=${encodeURIComponent(metadata.title)}&url=${encodeURIComponent(shareUrl)}`, '_blank');
                            }
                        }
                    });
                }

            } catch (e) {
                document.getElementById('post-content').innerHTML = `
                    <div class="post-error">
                        <h1>Post Not Found</h1>
                        <p>The requested post could not be found. <a href="/blog">Return to newslogger</a></p>
                    </div>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', loadPost);
    </script>
</body>
</html>
